services:
  node:
    build: .
    image: semanticweft-node:latest
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      # Persistent SQLite database. Data survives container restarts.
      - node-data:/data
    environment:
      # -- Required in production -----------------------------------------
      # Set this to the public host URL where your node is reachable by peers.
      # Without it, federation peers cannot connect back to you.
      SWEFT_API_BASE: "${SWEFT_API_BASE:-http://localhost:3000}"

      # -- Identity (optional) -------------------------------------------
      # A stable DID for this node. Generated automatically on first start
      # and persisted in the database if left unset.
      # SWEFT_NODE_ID: "did:key:z6Mk..."

      # -- Display (optional) --------------------------------------------
      # Human-readable label shown in the discovery document.
      SWEFT_NAME: "${SWEFT_NAME:-}"
      # Operator contact shown in the discovery document (email or URL).
      SWEFT_CONTACT: "${SWEFT_CONTACT:-}"

      # -- Storage -------------------------------------------------------
      # Path inside the container to the SQLite file.
      # Change the volume mount above if you redirect this.
      SWEFT_DB: /data/node.db

      # -- Federation (optional) ----------------------------------------
      # Comma-separated list of peer host URLs for bootstrap discovery.
      SWEFT_BOOTSTRAP_PEERS: "${SWEFT_BOOTSTRAP_PEERS:-}"
      # Seconds between federation sync rounds (default: 60).
      SWEFT_SYNC_INTERVAL_SECS: "${SWEFT_SYNC_INTERVAL_SECS:-60}"
      # Maximum number of peers to track (default: 100).
      SWEFT_MAX_PEERS: "${SWEFT_MAX_PEERS:-100}"

      # -- Rate limiting (optional) -------------------------------------
      # Max requests per minute per client IP. 0 = unlimited.
      SWEFT_RATE_LIMIT: "${SWEFT_RATE_LIMIT:-60}"

      # -- Logging -------------------------------------------------------
      RUST_LOG: "${RUST_LOG:-semanticweft_node=info}"

volumes:
  node-data:
